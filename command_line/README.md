README for running MD simulations and analyzing them using the LE4PD-3N code

WORKFLOW:

1) To start, all that is needed is the desired PDB file. If there are non-canonical residues in the PDB, ligands with atomtypes not present in the desired force field, etc., then this code not guaranteed to work. I can (almost) always guarantee it will work for plain vanilla PDBs (no ligands, no missing residues, etc.). A second note is that these codes are designed to run on the Expanse supercomputer and that one alone. They **should** work on any other machine, but the ``module load'' commmands will have to be changed to accommodate the lack of modules, etc. Basically, the scripts must simply be adapted so that the correct gmx binary is being used with the correct MPI libraries, if running in parallel.

Okay, caveats out of the way, all that is needed is the desired PDB file in the current working directory; this PDB is hard-coded and must be changed by changing the PDB constant in the run.sh file. Also hard-coded are the force field and the water model; they are set to automatically pick the AMBER03 force field and TIP3P water model; these selections can be changed by merely changeing the value of the variables FF and H2O, respectively, in the run.sh file. As usual, the default force field can be over-ridden by placing the desired force field ffolder (with the .ff extension) in the current working directory. Then, the FF variable should be kept as "1" to select this force field for creation of the .top file, etc.

The run.sh file will setup the simulation (add missing hydrogens, create the simulations box, add water, add the desired number of ions, run energy minimization, etc.); these inital GROMACS commands for setting up the simulation are found in the em.sh file. As with the force field and water model, the box size and ion concentration are hard-coded and must be changed manually inside the em.sh file. The box size is set using the -d flag in the gmx editconf command, and the ion concentration is set using the -neutral and -conc flags in the gmx genion command. The -d flag in gmx edidtconf gives the *minimum* distance from any part of the protein to a box face in nanometers while in gmx genion -conc sets the ion concentration in M and -neutral adds ions to neutralize the solute above the concentration given by -conc. Following solvation and ionization, the simulation box is energy minimized, with the energy minimization parameters set in the em.mdp file.

2) Next, the simulation box (solute plus solvent) is equilibrated. Right now, the workflow is set up to perform only NPT equilibration, which is probably fine provided the subsequent production run is sufficiently long (> 100 ns). The parameters for the NPT equilibration step are set in the eq.mdp file. Note that the eq.sh file is chained to the run.sh file, so the equilibration is set to run automatically following the energy minimization, provided there have been no problems with the energy minimization step. Likewise, the production run is chained to the equilibration step so, provided there are no problems in the equilibration, the production run will proceed immediately following the equilibration.

3) The production run follows the equilibration automatically. The parameters for the production run are set in the pro.mdp file. By default, the production run is set to use the NVT ensemble at 300K. The inupt GRO file is hard coded, but is set to be the default output from the eq.sh script. If either is changed, then both should be changed. The prod.sh script controlling the production run is set to automatically quit after running the simulatiion for 23 hours, then to re-submit the simulation for a total of 10 times. Thus, the prod.sh script is programmed to simulate for a total of 230 hours or until the production run reaches the desired number of integration steps. The amount of simulation run per cycle and the number of cycles can be adjusted by changing the "MAX_TIME" and "cycles" variables in the prod.sh script, respectively.

4) Following the completion of the production run, the simulation must be processed using process.sh in the "codes" directory. The variable "protname" should be the suffix of the output files from the production run, and the variable "FILE_PATH" needs to be the path to the output simulation files from the production run. The process.sh script will then automatically remove PBCs and rotations and translations from the simulation, and save a processed all-atom and CA-only trajectory. After processing, the script will automatically run the LE4PD-3N analysis codes, but the files must be present in the current working directory. These are the run_le4pd.sh, run_le4pd.py, and le4pd.py codes.

5) The run_le4pd.py is set up to using the le4pd.py file to calculate everything required for the LE4PD-3N analysis (covariance matrix, A matrix, H matrix, Q and Q^-1 matrices, friction coefficients, mode trajectories, mode dependent free-energy barriers, ...). The code calculates pretty much everything except time correlation functions for simulation and theory, which, for the simulation side, I left as the original FORTRAN codes since they were significantly more efficient and easy to parallelize.

That's about it. For calculating time correlation functions and advanced analysis, reference should be made to the GitHub repository (https://github.com/erb24/LE4PD-XYZ) -- the notebooks there should be especially useful for, e.g., extracting pathways and interpreting the modes. Please email me at ebeyerle@umd.edu with any comments or questions or concerns.
